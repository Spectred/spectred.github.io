<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.51">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="logo.jpeg"><title>分布式 | 学习笔记</title><meta name="description" content="✍🏻好记性不如烂笔头，站在岸上学不会游泳。泉水挑不干，知识学不完">
    <link rel="modulepreload" href="/assets/app.94cd83f3.js"><link rel="modulepreload" href="/assets/distributed.html.d3719dcf.js"><link rel="modulepreload" href="/assets/distributed.html.f131bd4a.js"><link rel="prefetch" href="/assets/index.html.71eb020f.js"><link rel="prefetch" href="/assets/index.html.fbaf26e3.js"><link rel="prefetch" href="/assets/index.html.b9e4ba9d.js"><link rel="prefetch" href="/assets/x.html.3a9e5e82.js"><link rel="prefetch" href="/assets/index.html.62c5cad4.js"><link rel="prefetch" href="/assets/dubbo.html.c42471d3.js"><link rel="prefetch" href="/assets/java.html.deb3e07a.js"><link rel="prefetch" href="/assets/jvm.html.fe73eb41.js"><link rel="prefetch" href="/assets/kafka.html.8d53552b.js"><link rel="prefetch" href="/assets/microservices.html.c6889d81.js"><link rel="prefetch" href="/assets/mybatis.html.79562dd3.js"><link rel="prefetch" href="/assets/mysql.html.cbaa6932.js"><link rel="prefetch" href="/assets/project.html.2552e28a.js"><link rel="prefetch" href="/assets/redis.html.72e8f2b1.js"><link rel="prefetch" href="/assets/spring.html.4b3357ee.js"><link rel="prefetch" href="/assets/index.html.cd286c3d.js"><link rel="prefetch" href="/assets/index.html.c99c6c4b.js"><link rel="prefetch" href="/assets/class1.html.793065ce.js"><link rel="prefetch" href="/assets/class2.html.bac3cdc9.js"><link rel="prefetch" href="/assets/index.html.e893d866.js"><link rel="prefetch" href="/assets/array.html.d73ed7e3.js"><link rel="prefetch" href="/assets/complexity.html.c278cefc.js"><link rel="prefetch" href="/assets/linkedlist.html.9de2a1d7.js"><link rel="prefetch" href="/assets/queue.html.a05a8057.js"><link rel="prefetch" href="/assets/recursion.html.99479a46.js"><link rel="prefetch" href="/assets/sort.html.8e73c57c.js"><link rel="prefetch" href="/assets/stack.html.7ec8455e.js"><link rel="prefetch" href="/assets/trietree.html.137d52b4.js"><link rel="prefetch" href="/assets/index.html.7b7e813f.js"><link rel="prefetch" href="/assets/linux.html.64e797fb.js"><link rel="prefetch" href="/assets/index.html.3252d128.js"><link rel="prefetch" href="/assets/started.html.d20bce38.js"><link rel="prefetch" href="/assets/index.html.b80bccee.js"><link rel="prefetch" href="/assets/started.html.202e2f6e.js"><link rel="prefetch" href="/assets/index.html.2b3e12e8.js"><link rel="prefetch" href="/assets/cache.html.22a14e77.js"><link rel="prefetch" href="/assets/config.html.8d60cdf2.js"><link rel="prefetch" href="/assets/started.html.388bf76b.js"><link rel="prefetch" href="/assets/index.html.298cd6e9.js"><link rel="prefetch" href="/assets/components_design.html.6f3ac77e.js"><link rel="prefetch" href="/assets/echo.html.e4fb45a4.js"><link rel="prefetch" href="/assets/io.html.94b26f07.js"><link rel="prefetch" href="/assets/socket.html.97b809a1.js"><link rel="prefetch" href="/assets/sourcecode.html.35d3b0ac.js"><link rel="prefetch" href="/assets/index.html.5642cff9.js"><link rel="prefetch" href="/assets/started.html.06ecce42.js"><link rel="prefetch" href="/assets/index.html.5650f3a2.js"><link rel="prefetch" href="/assets/atomic.html.c3287777.js"><link rel="prefetch" href="/assets/collector.html.e0a2b5fd.js"><link rel="prefetch" href="/assets/jmm.html.62429a45.js"><link rel="prefetch" href="/assets/locks.html.17e1f24a.js"><link rel="prefetch" href="/assets/threads.html.cccfe721.js"><link rel="prefetch" href="/assets/tools.html.5be6df0c.js"><link rel="prefetch" href="/assets/index.html.289ae4b9.js"><link rel="prefetch" href="/assets/unsafe.html.cf9d43fd.js"><link rel="prefetch" href="/assets/index.html.db4d47ed.js"><link rel="prefetch" href="/assets/app.html.d91d3cfd.js"><link rel="prefetch" href="/assets/install.html.c78cd86f.js"><link rel="prefetch" href="/assets/struct.html.a895855a.js"><link rel="prefetch" href="/assets/index.html.c88ed4d7.js"><link rel="prefetch" href="/assets/arch.html.3a439130.js"><link rel="prefetch" href="/assets/backups.html.d3bee46f.js"><link rel="prefetch" href="/assets/cluster.html.3c9a36f6.js"><link rel="prefetch" href="/assets/command.html.96d1a431.js"><link rel="prefetch" href="/assets/indexes.html.ece7701e.js"><link rel="prefetch" href="/assets/monitor.html.0884c305.js"><link rel="prefetch" href="/assets/secure.html.32817460.js"><link rel="prefetch" href="/assets/started.html.f5a7ae95.js"><link rel="prefetch" href="/assets/use.html.e95d4c21.js"><link rel="prefetch" href="/assets/index.html.076891d5.js"><link rel="prefetch" href="/assets/started.html.03b2602e.js"><link rel="prefetch" href="/assets/index.html.08be483b.js"><link rel="prefetch" href="/assets/started.html.e8d12c70.js"><link rel="prefetch" href="/assets/index.html.0e4e3099.js"><link rel="prefetch" href="/assets/ZooKeeper.html.a88c9c03.js"><link rel="prefetch" href="/assets/index.html.9fafefa5.js"><link rel="prefetch" href="/assets/discovery.html.d50fc58a.js"><link rel="prefetch" href="/assets/gateway.html.ffe37822.js"><link rel="prefetch" href="/assets/info.html.c39244ca.js"><link rel="prefetch" href="/assets/404.html.c3e557d0.js"><link rel="prefetch" href="/assets/index.html.4e742d23.js"><link rel="prefetch" href="/assets/index.html.73aa5288.js"><link rel="prefetch" href="/assets/index.html.3ee302b9.js"><link rel="prefetch" href="/assets/x.html.fec14a92.js"><link rel="prefetch" href="/assets/index.html.e6aac125.js"><link rel="prefetch" href="/assets/dubbo.html.079fd885.js"><link rel="prefetch" href="/assets/java.html.83033096.js"><link rel="prefetch" href="/assets/jvm.html.76c64a06.js"><link rel="prefetch" href="/assets/kafka.html.1ffe9f08.js"><link rel="prefetch" href="/assets/microservices.html.c1981abe.js"><link rel="prefetch" href="/assets/mybatis.html.633981ea.js"><link rel="prefetch" href="/assets/mysql.html.4447af64.js"><link rel="prefetch" href="/assets/project.html.fb44bd4c.js"><link rel="prefetch" href="/assets/redis.html.bf6084c9.js"><link rel="prefetch" href="/assets/spring.html.14bd9e82.js"><link rel="prefetch" href="/assets/index.html.4ee2a004.js"><link rel="prefetch" href="/assets/index.html.d6bdd141.js"><link rel="prefetch" href="/assets/class1.html.f4f39bba.js"><link rel="prefetch" href="/assets/class2.html.c13d0b8b.js"><link rel="prefetch" href="/assets/index.html.e746bfb0.js"><link rel="prefetch" href="/assets/array.html.d4a3bc2e.js"><link rel="prefetch" href="/assets/complexity.html.cd6ec097.js"><link rel="prefetch" href="/assets/linkedlist.html.21683035.js"><link rel="prefetch" href="/assets/queue.html.d20f7634.js"><link rel="prefetch" href="/assets/recursion.html.30ee1248.js"><link rel="prefetch" href="/assets/sort.html.ee079374.js"><link rel="prefetch" href="/assets/stack.html.0d9359f9.js"><link rel="prefetch" href="/assets/trietree.html.5f9a9643.js"><link rel="prefetch" href="/assets/index.html.e5687090.js"><link rel="prefetch" href="/assets/linux.html.7bb233b4.js"><link rel="prefetch" href="/assets/index.html.aa07d019.js"><link rel="prefetch" href="/assets/started.html.f32153a2.js"><link rel="prefetch" href="/assets/index.html.63d5b5ec.js"><link rel="prefetch" href="/assets/started.html.6ff9624f.js"><link rel="prefetch" href="/assets/index.html.576a386c.js"><link rel="prefetch" href="/assets/cache.html.653c0a71.js"><link rel="prefetch" href="/assets/config.html.b0cfeda3.js"><link rel="prefetch" href="/assets/started.html.db6b5333.js"><link rel="prefetch" href="/assets/index.html.33d9a178.js"><link rel="prefetch" href="/assets/components_design.html.60c81bf5.js"><link rel="prefetch" href="/assets/echo.html.0df92987.js"><link rel="prefetch" href="/assets/io.html.1c4f57eb.js"><link rel="prefetch" href="/assets/socket.html.c52bd2aa.js"><link rel="prefetch" href="/assets/sourcecode.html.da9775cb.js"><link rel="prefetch" href="/assets/index.html.a32be742.js"><link rel="prefetch" href="/assets/started.html.b5b3a550.js"><link rel="prefetch" href="/assets/index.html.8f304fd5.js"><link rel="prefetch" href="/assets/atomic.html.093e6cd0.js"><link rel="prefetch" href="/assets/collector.html.8097d670.js"><link rel="prefetch" href="/assets/jmm.html.063ce5ab.js"><link rel="prefetch" href="/assets/locks.html.b1b40aea.js"><link rel="prefetch" href="/assets/threads.html.c7f3ce08.js"><link rel="prefetch" href="/assets/tools.html.01784e1e.js"><link rel="prefetch" href="/assets/index.html.3002870b.js"><link rel="prefetch" href="/assets/unsafe.html.17bc4713.js"><link rel="prefetch" href="/assets/index.html.af258e94.js"><link rel="prefetch" href="/assets/app.html.90ea067a.js"><link rel="prefetch" href="/assets/install.html.a554fa67.js"><link rel="prefetch" href="/assets/struct.html.fc028613.js"><link rel="prefetch" href="/assets/index.html.6b4c4aeb.js"><link rel="prefetch" href="/assets/arch.html.b1786388.js"><link rel="prefetch" href="/assets/backups.html.0bbd9bc0.js"><link rel="prefetch" href="/assets/cluster.html.1f926ca5.js"><link rel="prefetch" href="/assets/command.html.54debdc2.js"><link rel="prefetch" href="/assets/indexes.html.fd9cf3d3.js"><link rel="prefetch" href="/assets/monitor.html.33507a53.js"><link rel="prefetch" href="/assets/secure.html.45e5ee71.js"><link rel="prefetch" href="/assets/started.html.92ef6148.js"><link rel="prefetch" href="/assets/use.html.34e6a7f6.js"><link rel="prefetch" href="/assets/index.html.45718f32.js"><link rel="prefetch" href="/assets/started.html.5d8e7fd4.js"><link rel="prefetch" href="/assets/index.html.deef9efe.js"><link rel="prefetch" href="/assets/started.html.b80f9c88.js"><link rel="prefetch" href="/assets/index.html.3934bf05.js"><link rel="prefetch" href="/assets/ZooKeeper.html.8f29493c.js"><link rel="prefetch" href="/assets/index.html.04ca7866.js"><link rel="prefetch" href="/assets/discovery.html.96951ab0.js"><link rel="prefetch" href="/assets/gateway.html.fa7d04d2.js"><link rel="prefetch" href="/assets/info.html.64d2a31c.js"><link rel="prefetch" href="/assets/404.html.dd7ae71e.js">
    <link rel="stylesheet" href="/assets/style.f4d22aab.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><!----><span class="site-name">学习笔记</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/interview" class="router-link-active" aria-label="😈面试"><!--[--><!--]--> 😈面试 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="☕️Java"><span class="title">☕️Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="☕️Java"><span class="title">☕️Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/java/magic" class="" aria-label="🪄魔法"><!--[--><!--]--> 🪄魔法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/java/concurrent" class="" aria-label="🦋并发"><!--[--><!--]--> 🦋并发 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="框架"><span class="title">框架</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="框架"><span class="title">框架</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/frame/gRPC" class="" aria-label="gRPC"><!--[--><!--]--> gRPC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/frame/dubbo" class="" aria-label="Dubbo"><!--[--><!--]--> Dubbo <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/frame/mybatis" class="" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/frame/netty" class="" aria-label="Netty"><!--[--><!--]--> Netty <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/frame/rpc" class="" aria-label="RPC"><!--[--><!--]--> RPC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/frame/spring" class="" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="中间件"><span class="title">中间件</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="中间件"><span class="title">中间件</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/middleware/flink" class="" aria-label="Flink"><!--[--><!--]--> Flink <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/kafka" class="" aria-label="Kafka"><!--[--><!--]--> Kafka <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/mongodb/README.md" class="" aria-label="MongoDB"><!--[--><!--]--> MongoDB <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/mysql" class="" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/pulsar" class="" aria-label="Pulsar"><!--[--><!--]--> Pulsar <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/redis" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/zookeeper" class="" aria-label="ZooKeeper"><!--[--><!--]--> ZooKeeper <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="云原生"><span class="title">云原生</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="云原生"><span class="title">云原生</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/cloud_native/microservices" class="" aria-label="微服务"><!--[--><!--]--> 微服务 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com" rel="noopener noreferrer" target="_blank" aria-label="CI/CD"><!--[--><!--]--> CI/CD <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com" rel="noopener noreferrer" target="_blank" aria-label="DevOps"><!--[--><!--]--> DevOps <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com" rel="noopener noreferrer" target="_blank" aria-label="容器"><!--[--><!--]--> 容器 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/architecture" class="" aria-label="架构"><!--[--><!--]--> 架构 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="基础"><span class="title">基础</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="基础"><span class="title">基础</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/base/os" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/base/network" class="" aria-label="计算机网络"><!--[--><!--]--> 计算机网络 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/base/compiler" class="" aria-label="编译原理"><!--[--><!--]--> 编译原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/base/alg" class="" aria-label="数据结构和算法"><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/doraemon" class="" aria-label="百宝箱"><!--[--><!--]--> 百宝箱 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/Spectred/spectred.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/interview" class="router-link-active" aria-label="😈面试"><!--[--><!--]--> 😈面试 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="☕️Java"><span class="title">☕️Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="☕️Java"><span class="title">☕️Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/java/magic" class="" aria-label="🪄魔法"><!--[--><!--]--> 🪄魔法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/java/concurrent" class="" aria-label="🦋并发"><!--[--><!--]--> 🦋并发 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="框架"><span class="title">框架</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="框架"><span class="title">框架</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/frame/gRPC" class="" aria-label="gRPC"><!--[--><!--]--> gRPC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/frame/dubbo" class="" aria-label="Dubbo"><!--[--><!--]--> Dubbo <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/frame/mybatis" class="" aria-label="MyBatis"><!--[--><!--]--> MyBatis <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/frame/netty" class="" aria-label="Netty"><!--[--><!--]--> Netty <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/frame/rpc" class="" aria-label="RPC"><!--[--><!--]--> RPC <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/frame/spring" class="" aria-label="Spring"><!--[--><!--]--> Spring <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="中间件"><span class="title">中间件</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="中间件"><span class="title">中间件</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/middleware/flink" class="" aria-label="Flink"><!--[--><!--]--> Flink <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/kafka" class="" aria-label="Kafka"><!--[--><!--]--> Kafka <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/mongodb/README.md" class="" aria-label="MongoDB"><!--[--><!--]--> MongoDB <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/mysql" class="" aria-label="MySQL"><!--[--><!--]--> MySQL <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/pulsar" class="" aria-label="Pulsar"><!--[--><!--]--> Pulsar <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/redis" class="" aria-label="Redis"><!--[--><!--]--> Redis <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/zookeeper" class="" aria-label="ZooKeeper"><!--[--><!--]--> ZooKeeper <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="云原生"><span class="title">云原生</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="云原生"><span class="title">云原生</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/cloud_native/microservices" class="" aria-label="微服务"><!--[--><!--]--> 微服务 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com" rel="noopener noreferrer" target="_blank" aria-label="CI/CD"><!--[--><!--]--> CI/CD <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com" rel="noopener noreferrer" target="_blank" aria-label="DevOps"><!--[--><!--]--> DevOps <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a class="external-link" href="https://github.com" rel="noopener noreferrer" target="_blank" aria-label="容器"><!--[--><!--]--> 容器 <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/architecture" class="" aria-label="架构"><!--[--><!--]--> 架构 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="基础"><span class="title">基础</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="基础"><span class="title">基础</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/base/os" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/base/network" class="" aria-label="计算机网络"><!--[--><!--]--> 计算机网络 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/base/compiler" class="" aria-label="编译原理"><!--[--><!--]--> 编译原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/base/alg" class="" aria-label="数据结构和算法"><!--[--><!--]--> 数据结构和算法 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/doraemon" class="" aria-label="百宝箱"><!--[--><!--]--> 百宝箱 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/Spectred/spectred.github.io" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">分布式 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/interview/distributed.html#_1-分布式锁" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. 分布式锁"><!--[--><!--]--> 1. 分布式锁 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/interview/distributed.html#_2-分布式缓存" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. 分布式缓存"><!--[--><!--]--> 2. 分布式缓存 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/interview/distributed.html#_3-分布式事务" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. 分布式事务"><!--[--><!--]--> 3. 分布式事务 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/interview/distributed.html#_4-分布式消息队列" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. 分布式消息队列"><!--[--><!--]--> 4. 分布式消息队列 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/interview/distributed.html#_5-分布式存储" class="router-link-active router-link-exact-active sidebar-item" aria-label="5. 分布式存储"><!--[--><!--]--> 5. 分布式存储 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/interview/distributed.html#_6-分布式基础理论" class="router-link-active router-link-exact-active sidebar-item" aria-label="6. 分布式基础理论"><!--[--><!--]--> 6. 分布式基础理论 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="分布式" tabindex="-1"><a class="header-anchor" href="#分布式" aria-hidden="true">#</a> 分布式</h1><blockquote><p>👍🏻 <a href="https://icyfenix.cn/" target="_blank" rel="noopener noreferrer">凤凰架构<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><h2 id="_1-分布式锁" tabindex="-1"><a class="header-anchor" href="#_1-分布式锁" aria-hidden="true">#</a> 1. 分布式锁</h2><blockquote><p><a href="https://mp.weixin.qq.com/s/s8xjm1ZCKIoTGT3DCVA4aw" target="_blank" rel="noopener noreferrer">深度剖析：Redis分布式锁到底安全吗？看完这篇文章彻底懂了！<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://github.com/redisson/redisson/wiki/8.-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81%E5%92%8C%E5%90%8C%E6%AD%A5%E5%99%A8" target="_blank" rel="noopener noreferrer">Redisson-8.分布式锁和同步器<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></blockquote><p>分布式锁实现多个进程对共享资源的互斥。实现方式上可以采用第三方中间件来做，如<code>MySQL</code>、<code>ZooKeeper</code>、<code>Redis</code>、<code>etcd</code>等</p><h3 id="_1-1-基于关系型数据库-mysql-的分布式锁" tabindex="-1"><a class="header-anchor" href="#_1-1-基于关系型数据库-mysql-的分布式锁" aria-hidden="true">#</a> 1.1 基于关系型数据库(MySQL)的分布式锁</h3><p>悲观锁： <code>select id from t where col = xx for update</code>，会一直阻塞到事务提交，</p><p>乐观锁: <code>select id,old_version from t where col = xx</code>和 <code>update t set ver = old_version+1 where col=xx and ver=old_verison</code></p><h3 id="_1-2-基于redis的分布式锁" tabindex="-1"><a class="header-anchor" href="#_1-2-基于redis的分布式锁" aria-hidden="true">#</a> 1.2 基于Redis的分布式锁</h3><h4 id="_1-2-1-setnx-lock-v-和del-lock" tabindex="-1"><a class="header-anchor" href="#_1-2-1-setnx-lock-v-和del-lock" aria-hidden="true">#</a> 1.2.1 <code>setnx lock v</code> 和<code>del lock</code></h4><p><strong>加锁</strong>时客户端1加锁成功 <code>SETNX lock 1 =&gt; 1</code>,客户端2加锁失败<code>SETNX lock 1 =&gt; 0</code></p><p><strong>解锁</strong>时客户端1 <code>del lock =&gt; 1</code></p><p><strong>存在的问题</strong>: 当客户端1中没能释放锁(如业务异常或进程崩溃)，导致其他客户端一直都拿不到锁，导致死锁 （这种情况需要人工介入解锁）</p><h4 id="_1-2-2-set-lock-v-ex-n-nx" tabindex="-1"><a class="header-anchor" href="#_1-2-2-set-lock-v-ex-n-nx" aria-hidden="true">#</a> 1.2.2 <code>set lock v ex n nx</code></h4><p>为了避免死锁的问题，添加过期时间自动释放锁，用一行命令保证原子性，如<code>set lock 1 ex 10 nx =&gt; OK</code>,其他客户端尝试加锁时返回<code>(nil)</code></p><p><strong>存在的问题:</strong></p><p>A. 过期时间可能不准确，设置少了导致提前释放锁，设置多了会加锁时间过长(一般没这个问题，锁可以释放时可以指定del lock,但是会导致B问题)，</p><p>B. 一个客户端可能释放了其他客户端锁持有的锁</p><h4 id="_1-2-3-set-lock-uuid-ex-n-nx" tabindex="-1"><a class="header-anchor" href="#_1-2-3-set-lock-uuid-ex-n-nx" aria-hidden="true">#</a> 1.2.3 <code>set lock $uuid ex n nx</code></h4><p>对于客户端释放其他客户端持有锁的问题，可以将val设置为一个随机且唯一的值(只有加锁的客户端知道，也可以是线程号)</p><p><strong>加锁</strong>时: <code>set lock 45r8iu ex 10 nx</code></p><p><strong>解锁</strong>时: 采用Lua脚本保证原子性，先判断是否为当前客户端加锁，是的话进行删除</p><div class="language-lua ext-lua line-numbers-mode"><pre class="language-lua"><code><span class="token operator">//</span> 判断锁是自己的，才释放
<span class="token keyword">if</span> redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span>KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> ARGV<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">then</span>
    <span class="token keyword">return</span> redis<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;DEL&quot;</span><span class="token punctuation">,</span>KEYS<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">else</span>
    <span class="token keyword">return</span> <span class="token number">0</span>
<span class="token keyword">end</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-2-4-使用redisson" tabindex="-1"><a class="header-anchor" href="#_1-2-4-使用redisson" aria-hidden="true">#</a> 1.2.4 使用<a href="https://github.com/redisson/redisson" target="_blank" rel="noopener noreferrer">Redisson<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h4><p>为了解决锁可能提前过期的问题，可以在加锁时设置过期时间，然后通过守护线程定时检测锁的失效时间，如果快过期了但是业务操作还未完成，就自动进行续期</p><blockquote><p>此时，只通过Redis解决分布式锁的方案如下：</p><ol><li>🔐加锁时，采用<code>set lock $uuid ex 10 nx</code>，来保证互斥性，自动失效性，只能加锁客户端解锁，并且开启守护线程检测失效，根据业务决定是否需要续期</li><li>🔓解锁时, 通过Lua脚本保证原子性，先判断是否为客户单加锁，是的话才解锁</li></ol></blockquote><p><strong><code>Redisson</code>的分布式锁原理是怎样的？</strong></p><p><strong>加锁：</strong></p><p>Redisson首先通过hash选择一个redis节点，然后执行加锁的Lua脚本来保证原子性，设置一个hash结构的锁 <code>hset lock $uuid:1 1</code>,其中$uudi:1表示完成了加锁，val的1表示加锁加了一次(可重入)，</p><p>当其他客户段想获取锁时执行同样的脚本先判断key lock是否存在，在判断是否有客户端2的ID，以及锁的剩余时间，进行自旋，</p><p>在加锁成功的同时会启用一个<code>watch dog</code>的后台线程，每隔10秒进行检查，判断是否需要续期</p><p><strong>解锁：</strong></p><p>由于是可重入锁，当val值为0时表示不再持有锁，通过<code>pub/sub</code>的方式进行释放锁执行<code>del lock</code></p><h4 id="_1-2-5-redlock" tabindex="-1"><a class="header-anchor" href="#_1-2-5-redlock" aria-hidden="true">#</a> 1.2.5 RedLock</h4><p>RedLock的大概流程是先有多于5个的Redis实例，然后分别向各个实例请求加锁，当大于半数加锁成功就认为是加锁成功，释放锁时操作所有节点</p><p>但是要考虑加锁的耗时，网络等原因</p><h3 id="_1-3-基于zookeeper的分布式锁" tabindex="-1"><a class="header-anchor" href="#_1-3-基于zookeeper的分布式锁" aria-hidden="true">#</a> 1.3 基于ZooKeeper的分布式锁</h3><p>ZooKeeper实现的分布式锁:</p><ol><li>客户端1创建临时节点（会产生惊群效应，一般使用临时有序节点） 如<code>/lock</code></li><li>客户端2尝试创建临时节点失败，加锁失败，</li><li>客户端1操作共享资源完成后，删除<code>/lock</code>节点，释放锁，客户端2通过watcher机制发现可以加锁</li></ol><p><strong>可能有的问题</strong>: ZooKeeper长时间收不到客户端的心跳(例如GC或者网络延迟)，也会把临时节点删除，导致其他客户端提前拿到了锁，但是原客户端认为自己有锁</p><blockquote><p>ZooKeeper和Redis实现分布式锁的优劣</p><p>ZooKeeper实现简单，不需要考虑锁的过期时间，通过<code>watcher</code>加锁失败可以等待锁的释放，实现乐观锁，</p><p>但是ZooKeeper的部署和运维成本高，性能上不如Redis，也存在着客户端与ZooKeeper长时间失联导致的锁提前释放的问题</p></blockquote><h2 id="_2-分布式缓存" tabindex="-1"><a class="header-anchor" href="#_2-分布式缓存" aria-hidden="true">#</a> 2. 分布式缓存</h2><blockquote><p>前端有页面和浏览器缓存，Application Cache，localStore等，</p><p>网络传输缓存，会有多层缓存，CDN,负载均衡，</p><p>服务端缓存，本地缓存:Guava,Map,Caffine,外部缓存大多数服务端缓存采用redis，</p><p>数据库缓存,MyBtais的一二级缓存，MySQL的缓存</p></blockquote><h3 id="_2-1-redis的持久化-高可用-过期策略-缓存异常问题-缓存和数据库双写一致性问题" tabindex="-1"><a class="header-anchor" href="#_2-1-redis的持久化-高可用-过期策略-缓存异常问题-缓存和数据库双写一致性问题" aria-hidden="true">#</a> 2.1 Redis的持久化，高可用，过期策略，缓存异常问题，缓存和数据库双写一致性问题</h3><blockquote><p>https://spectred.github.io/interview/redis.html</p></blockquote><h2 id="_3-分布式事务" tabindex="-1"><a class="header-anchor" href="#_3-分布式事务" aria-hidden="true">#</a> 3. 分布式事务</h2><blockquote><p>分布式事务指多个服务同时访问多个数据源的事务处理机制。主流的方案有2PC,3PC,TCC,可靠事件队列,SAGA事务</p></blockquote><h3 id="_3-1-2pc-两阶段提交" tabindex="-1"><a class="header-anchor" href="#_3-1-2pc-两阶段提交" aria-hidden="true">#</a> 3.1 2PC 两阶段提交</h3><p>存在协调者和参与者，准备阶段: 协调者询问参与者是否可正常执行，参与者执行事务但不提交；提交阶段: 协调者通知参与提交，参与者进行提交，如果有失败则整体回滚</p><p>存在的问题： 资源被同步阻塞，协调者单点故障</p><blockquote><p>典型应用: <strong>MySQL的主从复制</strong></p><p>MySQL使用2PC，内部自动将普通事务当做一个XA事务(内部分布式事务)来保证<code>binlog</code>和<code>redolog</code>的一致性:</p><ul><li>Commit会被自动分成Prepare和Commit两个阶段</li><li>binlog会被当做事务协调者，binlog event会被当做协调者日志</li></ul></blockquote><h3 id="_3-2-3pc-三阶段提交" tabindex="-1"><a class="header-anchor" href="#_3-2-3pc-三阶段提交" aria-hidden="true">#</a> 3.2 3PC 三阶段提交</h3><p>为解决2PC的同步阻塞问题，3PC在协调者和参与者中都引入了超时机制。</p><p><code>CanCommit</code>： 协调者询问参与者是否可正常执行，参与者预估判断是否可执行，不做事务操作</p><p><code>PreCommit</code>： 协调者询问参与者是否可正常执行，参与者执行事务但不提交</p><p><code>DoCommit</code>： 协调者向所有参与者发起事务提交通知，参与者收到通知或者超时提交事务向协调者反馈结果</p><p>改进内容: 引入超时机制，添加预提交阶段</p><p>存在的问题： 第三阶段中，如果参与者收到了<code>PreCommit</code>消息后，出现了不能正常通信的问题，参与者依然会提交事务导致数据不一致</p><h3 id="_3-3-tcc" tabindex="-1"><a class="header-anchor" href="#_3-3-tcc" aria-hidden="true">#</a> 3.3 TCC</h3><blockquote><p>TCC基于业务层面的事务定义，锁粒度由业务自己控制，为了解决复杂业务中跨表跨库等大粒度资源锁定的问题。</p><p>TCC把事务运行过程分成 Try,Confirm/Cancel两个阶段，每个阶段逻辑由业务控制，避免长事务，可以获取更高性能</p></blockquote><p><code>Try</code>： 调用Try接口，尝试执行业务，完成所有业务检查，预留业务资源</p><p><code>Confirm</code>/<code>Cancel</code>：两者互斥，只能进入其中一个，并且都满足幂等性，允许失败重试</p><ul><li><code>Confirm</code>： 对业务系统做确认提交，确认执行业务操作，不做其他业务检查，只使用Try阶段预留的业务资源</li><li><code>Cancel</code>: 在业务执行错误，需要回滚的状态下执行业务取消，释放预留资源</li></ul><p>缺点: 侵入型强，事务管理器需要记录事务日志损耗性能</p><h3 id="_3-4-基于mq的可靠消息投递方案-最大努力交付" tabindex="-1"><a class="header-anchor" href="#_3-4-基于mq的可靠消息投递方案-最大努力交付" aria-hidden="true">#</a> 3.4 基于MQ的可靠消息投递方案(最大努力交付)</h3><ol><li><p>提交本地事务，向MQ发送消息，并将消息状态落库到消息表，</p></li><li><p>其他服务消费消息后提交本地事务，更新消息表，双向确认，</p></li><li><p>如果有问题需要手动/定时批量扫描进行补偿</p></li></ol><p>支持分布式事务的消息框架如RocketMQ原生就支持分布式事务操作</p><h3 id="_3-5-saga事务" tabindex="-1"><a class="header-anchor" href="#_3-5-saga事务" aria-hidden="true">#</a> 3.5 SAGA事务</h3><p>将一个大事务拆分成若干个小事务T1,T2...Tn,每个子事务设计对应的补偿动作C1,C2...Cn</p><p>有两种恢复策略</p><ul><li>正向恢复: 如果其中一个子事务提交失败，则对这个子事务一直重试至成功，不需要补偿 ，例如扣款了就要发货</li><li>反向恢复: 如果其中一个子事务提交失败，则一直执行对应的补充动作进行补偿直至成功</li></ul><h3 id="_3-6-⭐️seata" tabindex="-1"><a class="header-anchor" href="#_3-6-⭐️seata" aria-hidden="true">#</a> 3.6 ⭐️<a href="http://seata.io/zh-cn/" target="_blank" rel="noopener noreferrer">Seata<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></h3><blockquote><p>Seata 是一款开源的分布式事务解决方案，致力于在微服务架构下提供高性能和简单易用的分布式事务服务</p></blockquote><h2 id="_4-分布式消息队列" tabindex="-1"><a class="header-anchor" href="#_4-分布式消息队列" aria-hidden="true">#</a> 4. 分布式消息队列</h2><blockquote><p>https://spectred.github.io/interview/kafka.html</p></blockquote><h2 id="_5-分布式存储" tabindex="-1"><a class="header-anchor" href="#_5-分布式存储" aria-hidden="true">#</a> 5. 分布式存储</h2><h3 id="_5-1-读写分离" tabindex="-1"><a class="header-anchor" href="#_5-1-读写分离" aria-hidden="true">#</a> 5.1 读写分离</h3><blockquote><p>适用于读多写少</p></blockquote><p>为了不让数据库的读成为业务瓶颈，同时也为了保证写库的成功率，一般采用读写分离保证。可一主一从，一主多从</p><p><a href="https://spectred.github.io/interview/mysql.html#_16-mysql%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84" target="_blank" rel="noopener noreferrer">MySQL的主从复制<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h3 id="_5-2-分库分表" tabindex="-1"><a class="header-anchor" href="#_5-2-分库分表" aria-hidden="true">#</a> 5.2 分库分表</h3><blockquote><p>单表行数超过500万行或者单表容量超过2GB，才推荐分库分表</p></blockquote><p><a href="https://spectred.github.io/interview/mysql.html#_17-%E5%85%B3%E4%BA%8E%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8" target="_blank" rel="noopener noreferrer">分库分表<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>分库分表后，会引入分布式事务的问题，跨库关联查询(字段冗余)，跨库跨表的合并和排序(依赖分库分表中间件)</p><h2 id="_6-分布式基础理论" tabindex="-1"><a class="header-anchor" href="#_6-分布式基础理论" aria-hidden="true">#</a> 6. 分布式基础理论</h2><h3 id="_6-1-cap理论" tabindex="-1"><a class="header-anchor" href="#_6-1-cap理论" aria-hidden="true">#</a> 6.1 CAP理论</h3><p>CAP理论描述了在一个分布式系统中，涉及共享数据问题时，以下三个特性最多只能同步满足其中两个:</p><ul><li>Consistency <strong>一致性</strong>: 数据在任何时刻任何分布式节点中所看大的都是符合预期的</li><li>Availability <strong>可用性</strong>: 系统不间断地提供服务能力</li><li>Partition Tolerance <strong>分区容忍性</strong>: 分布式环境中部分节点因网络原因而彼此失联后，系统仍能正确的提供服务的能力</li></ul><h3 id="_6-2-base达成最终一致性" tabindex="-1"><a class="header-anchor" href="#_6-2-base达成最终一致性" aria-hidden="true">#</a> 6.2 BASE达成最终一致性</h3><blockquote><p>ACID保证强一致性</p></blockquote><ul><li>Basically Available 基本可用性</li><li>Soft State 柔性事务</li><li>Eventually Consistent 最终一致性</li></ul><h3 id="_6-3-分布式共识" tabindex="-1"><a class="header-anchor" href="#_6-3-分布式共识" aria-hidden="true">#</a> 6.3 分布式共识</h3><blockquote><p>目前面试还没被问过，被问到时再补充吧...😄</p></blockquote><h4 id="_6-3-1-paxos" tabindex="-1"><a class="header-anchor" href="#_6-3-1-paxos" aria-hidden="true">#</a> 6.3.1 Paxos</h4><h4 id="_6-3-2-multi-paxos" tabindex="-1"><a class="header-anchor" href="#_6-3-2-multi-paxos" aria-hidden="true">#</a> 6.3.2 Multi Paxos</h4><h4 id="_6-3-3-gossip" tabindex="-1"><a class="header-anchor" href="#_6-3-3-gossip" aria-hidden="true">#</a> 6.3.3 Gossip</h4><h4 id="_6-3-4-raft" tabindex="-1"><a class="header-anchor" href="#_6-3-4-raft" aria-hidden="true">#</a> 6.3.4 Raft</h4></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 1505073336@qq.com">spectred</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.94cd83f3.js" defer></script>
  </body>
</html>
