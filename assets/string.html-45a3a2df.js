import{_ as d,V as i,W as a,Z as e,$ as s,Y as n,a4 as t,F as o}from"./framework-eedf5ae1.js";const l={},c=e("h1",{id:"string",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#string","aria-hidden":"true"},"#"),s(" String")],-1),_={href:"https://redis.io/docs/data-types/strings",target:"_blank",rel:"noopener noreferrer"},h={href:"https://redis.io/commands/?group=string",target:"_blank",rel:"noopener noreferrer"},u={href:"https://github.com/Spectred/redis/blob/spectred_6.2/src/t_string.c",target:"_blank",rel:"noopener noreferrer"},p={href:"https://github.com/Spectred/redis/blob/spectred_6.2/src/sds.h",target:"_blank",rel:"noopener noreferrer"},b=e("h2",{id:"数据结构",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#数据结构","aria-hidden":"true"},"#"),s(" 数据结构")],-1),g=e("ul",null,[e("li",null,"如果value是64位有符号整数，Redis保存为8字节的Long类型整数(int编码方式)"),e("li",null,"如果value中包含字符串，Redis使用SDS(Simple Dynamic String)结构体保存"),e("li")],-1),S=e("h3",{id:"数据结构定义",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#数据结构定义","aria-hidden":"true"},"#"),s(" 数据结构定义")],-1),f={href:"https://github.com/Spectred/redis/blob/unstable/src/sds.h",target:"_blank",rel:"noopener noreferrer"},m=t(`<div class="language-C line-numbers-mode" data-ext="C"><pre class="language-C"><code>struct __attribute__ ((__packed__)) sdshdr8 {
    uint8_t len;            /* buf的已用长度,占4个字节 */
    uint8_t alloc;          /* buf的实际分配长度,占4个字节, 排除了header和null终止符 */
    unsigned char flags;    /* SDS类型,和SDS_TYPE_MASK计算出是sdshdr5/8/16/32/64 */
    char buf[];             /* 实际数据 */
};
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中<code>__attribute__ ((__packed__))</code>表示 告诉编译器在对结构体进行内存对齐时不要进行字节对齐填充，采用紧凑的方式分配内存。默认如果变量5个字节，不够8字节也会分配8字节，使用后只有5个字节。</p><div class="hint-container note"><p class="hint-container-title">注</p><p>和JDK中的@Contended的异同</p></div><h3 id="sds关键函数" tabindex="-1"><a class="header-anchor" href="#sds关键函数" aria-hidden="true">#</a> SDS关键函数</h3>`,4),v={href:"https://github.com/Spectred/redis/blob/spectred_6.2/src/sds.c",target:"_blank",rel:"noopener noreferrer"},D=t("<ul><li><code>sdsnewlen</code>: 创建一个新的SDS,并分配足够的空间以容纳指定长度的字符串</li><li><code>sdslen</code>: 返回SDS的当前长度</li><li><code>sdsfree</code>：释放SDS的内存空间。</li><li><code>sdscat</code>：将指定的字符串追加到SDS的末尾。</li><li><code>sdscpy</code>：将指定的字符串复制到SDS中。</li><li><code>sdsgrowzero</code>：将SDS的长度扩展到指定长度，并将扩展的字节用零填充。</li><li><code>sdscatprintf</code>：类似于C语言中的sprintf函数，将格式化的字符串追加到SDS中。</li></ul>",1);function k(x,C){const r=o("ExternalLinkIcon");return i(),a("div",null,[c,e("p",null,[e("a",_,[s("数据类型: string"),n(r)])]),e("p",null,[e("a",h,[s("命令: string"),n(r)])]),e("p",null,[e("a",u,[s("命令源码 t_string.c"),n(r)])]),e("p",null,[e("a",p,[s("数据结构 sds"),n(r)])]),b,g,S,e("p",null,[s("在"),e("a",f,[s("sds.h"),n(r)]),s("中定义如下结构体(包括sdshdr5,sdshdr8,sdshdr16,sdshdr32,sdshdr64)")]),m,e("p",null,[e("a",v,[s("sds.c"),n(r)])]),D])}const E=d(l,[["render",k],["__file","string.html.vue"]]);export{E as default};
